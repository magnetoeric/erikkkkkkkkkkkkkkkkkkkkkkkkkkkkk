title: 记一次redis迁移
tags:
  - redis
category: nosql
date: 2015-08-10 15:44:00

---
##事件
最近由于运维部门回收机器，没有通知就关闭了一个redis服务，redis中主要是同步的小区，导致搜索页猜词逻辑没有获得小区名称，继而导致分词服务请求量下降，产生报警，500页面数量升高也产生报警。

## 迁移
既然要回收了，就要对redis进行迁移，最开始打算在脚本同步时写2份redis（脚本是每天都跑的），然后更改读的配置，但是这样要在每一处写入的地方去再写一次，非常笨拙。于是回想到最近读的redis相关书籍，redis做主从同步，然后把代码中的配置切到从reids不就可以了。

## 相关命令
redis主从命令很简单  

```
SLAVEOF IP port  //主从
SLAVEOF NO ONE //停止主从
```

## 遇到的问题
在同步rdb过程中，产生了溢出，原因应该是没有使用缓存剔除，导致out of memory。还是马神比较在行，修改从数据库配置，使用lru替换规则，保证同步过程顺利进行，然后在配置中修改了reids的ip和端口，顺利进行了迁移